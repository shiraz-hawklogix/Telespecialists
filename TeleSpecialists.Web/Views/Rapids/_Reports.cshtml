@using TeleSpecialists.BLL.Helpers;
@using TeleSpecialists.BLL.Extensions;
@using TeleSpecialists.BLL;
@using TeleSpecialists.Models;
@using Microsoft.AspNet.Identity;
@if (User.IsInRole(UserRoles.Physician.ToDescription()))
    {
        var loggedInUser = ViewBag.loggedInUser as ApplicationUser;
        string userid = loggedInUser.Id;
    <script src="~/Scripts/flot/jquery.flot.min.js"></script>
    <script src="~/Scripts/curvedLines.js"></script>
    <script src="~/Scripts/Chart.js"></script>

    <link rel="stylesheet" href="~/Content/chartlist.css" />
    <link rel="stylesheet" href="/Content/dashboard.css">
    <link rel="stylesheet" href="/Content/simple-line-icons/simple-line-icons.css" />
    
    <input type="hidden" id="currentuserid" value="@userid" />
    <div class="row">
        <div class="col-12 text-right">
            <div class="nav-wrapper d-inline-block mt-4 mt-lg-0 stats_Indicator">
                <ul class="nav nav-pills">
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="btnWeek">Week</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="btnMonth">Month</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="btnQuarter">Quarter</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="btnTodayFrom1900EST">Today From 1900EST</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="btnTodayFrom700EST">Today From 700EST</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="#" id="btnTodayFromMidnight">Today From Midnight</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="card overflow-hidden dashboard-curved-chart" style="display: none;">
        <div class="card-body mx-3">
            <h2 class="card-title border-bottom-none">Case Types</h2>
            <div class="align-items-center mb-5 justify-content-between d-lg-flex d-xl-flex d-md-block d-block">
                <div id="chartLegend"></div>
            </div>
        </div>
        <div id="curved-line-chart" style="height: 200px;"></div>
    </div>
    <div class="row">
        <div class="col-12">
            <div class="card performance-cards">
                <div class="card-body">
                    <div class="row">
                        <div class="col-lg-4 col-xl-3 col-md-4 col-sm-6 d-flex flex-row justify-content-left align-items-center dashboard-indicators">
                            <div class="wrapper icon-circle bg-success">
                                <i class="icon-chart icons"></i>
                            </div>
                            <div class="wrapper text-wrapper">
                                <p class="text-dark" id="lblStrokeAlerts">0</p>
                                <p>Total Stroke Alerts</p>
                            </div>
                        </div>
                        <div class="col-lg-4 col-xl-3 col-md-4 col-sm-6 d-flex flex-row justify-content-left align-items-center dashboard-indicators">
                            <div class="wrapper icon-circle bg-danger">
                                <i class="icon-clock icons"></i>
                            </div>
                            <div class="wrapper text-wrapper">
                                <p class="text-dark" id="lblStatConsults">0</p>
                                <p>STAT Consults</p>
                            </div>
                        </div>
                        @*<div class="col-lg-4 col-xl-3 col-md-4 col-sm-6 d-flex flex-row justify-content-left align-items-center dashboard-indicators">
                                <div class="wrapper icon-circle bg-warning">
                                    <i class="icon-fire icons"></i>
                                </div>
                                <div class="wrapper text-wrapper">
                                    <p class="text-dark" id="lblNavigatorBlasts">0</p>
                                    <p>Navigator Blasts</p>
                                </div>
                            </div>
                            <div class="col-lg-4 col-xl-3 col-md-4 col-sm-6 d-flex flex-row justify-content-left align-items-center dashboard-indicators">
                                <div class="wrapper icon-circle bg-warning">
                                    <i class="icon-fire icons"></i>
                                </div>
                                <div class="wrapper text-wrapper">
                                    <p class="text-dark" id="lblPhysicianBlasts">0</p>
                                    <p>Physician Blasts</p>
                                </div>
                            </div>*@
                        @*<div class="col-lg-4 col-xl-3 col-md-4 col-sm-6 d-flex flex-row justify-content-left align-items-center dashboard-indicators">
                                <div class="wrapper icon-circle bg-primary">
                                    <i class="icon-check icons"></i>
                                </div>
                                <div class="wrapper text-wrapper">
                                    <p class="text-dark" id="lblOthers">0</p>
                                    <p>Others</p>
                                </div>
                            </div>*@
                        <div class="col-lg-4 col-xl-3 col-md-4 col-sm-6 d-flex flex-row justify-content-left align-items-center dashboard-indicators">
                            <div class="wrapper icon-circle bg-dark">
                                <i class="icon-phone icons"></i>
                            </div>
                            <div class="wrapper text-wrapper">
                                <p class="text-dark" id="lblAverageDoorToNeedle">00:00:00</p>
                                <p>Average Door to Needle</p>
                            </div>
                        </div>
                        <div class="col-lg-4 col-xl-3 col-md-4 col-sm-6 d-flex flex-row justify-content-left align-items-center dashboard-indicators">
                            <div class="wrapper icon-circle bg-info">
                                <i class="icon-call-out icons"></i>
                            </div>
                            <div class="wrapper text-wrapper">
                                <p class="text-dark" id="lblAverageLogonToNeedle">00:00:00</p>
                                <p>Average Login to Needle</p>
                            </div>
                        </div>
                        <div class="col-lg-4 col-xl-3 col-md-4 col-sm-6 d-flex flex-row justify-content-left align-items-center dashboard-indicators">
                            <div class="wrapper icon-circle bg-success">
                                <i class="icon-call-end icons"></i>
                            </div>
                            <div class="wrapper text-wrapper">
                                <p class="text-dark" id="lblAverageStartToFirstLogin">00:00:00</p>
                                <p>Average Start to First Login</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <input type="hidden" value="0" id="currentCount" />
    <script>
        var getcurrentuserid = $("#currentuserid").val();
        refreshAllSummary('Today', getcurrentuserid);
    $('.stats_Indicator .nav-link').off("click").click(function (e) {
        e.preventDefault();
        var getcurrentuserid = $("#currentuserid").val();
        if (refreshAllSummary.loadAllTimeout != undefined)
            window.clearTimeout(refreshAllSummary.loadAllTimeout);
        $('.nav.nav-pills>li>a').removeClass('active');
        $(this).addClass('active');
        refreshAllSummary($(this).text(), getcurrentuserid);
    });

        function refreshAllSummary(period, getcurrentuserid) {

        var currentUrl = $("#hdnCurrentUrl").val().toLowerCase();
        if (currentUrl == "/" || currentUrl == "/home" || currentUrl == "/home/index" || currentUrl.indexOf("/?rnd") == 0) {
            if (period != undefined && period != null && period != "") {
                $('#divPhysicianStatusSummaryRow').css('display', '');
                $.ajax({
                    url: '@Url.Action("GetAllSummaries")?filter=' + period + "&currentuserid=" + getcurrentuserid + "&currentCount=" + $("#currentCount").val(),
                    type: 'get',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    async: false,
                    success: function (data) {
                        if (data != undefined) {
                            caseStats(data.caseStats);
                        }

                    },
                    complete: function () {
                        if (refreshAllSummary.loadAllTimeout != undefined)
                            window.clearTimeout(refreshAllSummary.loadAllTimeout);
                        refreshAllSummary.loadAllTimeout = window.setTimeout(function () { refreshAllSummary($('.stats_Indicator .nav-link.active').text(), $("#currentuserid").val()) }, 5000);
                    }
                });
            }
            else {
                 $('#divPhysicianStatusSummaryRow').css('display', 'none');
            }
        }
    }

    function caseStats(data) {
        var totalCases = data[0].TotalCases;
        $('#lblStrokeAlerts').text(data[0].TotalStrokeAlert);
        $('#lblStatConsults').text(data[0].TotalStatConsults);
        $('#lblNavigatorBlasts').text(data[0].TotalNavigatorBlasts);
        $('#lblPhysicianBlasts').text(data[0].TotalPhysicianBlasts);

        $('#lblAverageDoorToNeedle').text(data[0].AverageDoorToNeedle);
        $('#lblAverageLogonToNeedle').text(data[0].AverageLogonToNeedle);
        $('#lblAverageStartToFirstLogin').text(data[0].AverageStartToFirstLogin);

        $("#currentCount").val(totalCases);
    }
    </script>
}


