
@using TeleSpecialists.BLL.ViewModels;
@model IEnumerable<FireBaseData>

@{
    Layout = null;
}
<!DOCTYPE html>

<html>
<head>
    <meta charset=utf-8 />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anonymous Authentication Example</title>
    <link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.orange-indigo.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script>
    @*<link rel="stylesheet" href="main.css">*@
    <link href="~/auth/main.css" rel="stylesheet" />
    <script src="https://www.gstatic.com/firebasejs/5.5.9/firebase-app.js"></script>
    <!-- Add additional services that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/5.5.9/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.5.9/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.5.9/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.5.9/firebase-messaging.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.5.9/firebase-functions.js"></script>


    <script>
        // Initialize Firebase
        const config = {
        apiKey: "AIzaSyDHC8RJ-uUoWIo3tYa9zzhVhvTxv5NuZF0",
        authDomain: "telecare-3724e.firebaseapp.com",
        databaseURL: "https://telecare-3724e.firebaseio.com",
        projectId: "telecare-3724e",
        storageBucket: "telecare-3724e.appspot.com",
        messagingSenderId: "922280291570",
        appId: "1:922280291570:web:6ce723cfaeeed0f7c8b46b",
        measurementId: "G-8TWCZJP852"
    };
     firebase.initializeApp(config);
        

        var chatRef = firebase.database().ref();

        var db = firebase.database();
        var auth = firebase.auth();




        function writeUserData(userId, name) {
            console.log('you are going to be update the record');
            firebase.database().ref('teleUsers/' + userId).set({
                userid: userId,
                username: name,
                email: "husain@gmail.com",
                firstName: "Ausnain",
                lastName: "Ahmad",
                Qualification: "BSCS(hons)",
                Designation: "Senior Software Engineer",
                displayName: name

                //profile_picture: imageUrl
            });
        }


        //<<<<<<<<<<<<<<<<<<<<<< Create Admin sdk >>>>>>>>>>>>>>>>>>>>>>>

        //<<<<<<<<<<<<<<<<<<<<<<<<< END >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>


        //<<<<<<<<<<<<<<<<<<<<<<<<< Create User with Password >>>>>>>>>>>>>>>>>>>>>>>>.


        function CallBothFunctions(id, name, email, password, teleid) {

            CreateWithPassword(id, name , email, password, teleid);
           // Update();
            //Detail();

        }

        function CreateWithPassword(id, name, email, password, teleid) {
            auth.createUserWithEmailAndPassword(email, password)
                //.then(function (user) {
                //user = auth.currentUser;
                //user.updateProfile({
                //    uid: user.uid,
                //    name: name,
                //    displayName: name
                //});
                //})
                .catch(function (error) {
            //    if (email == "aaaaaaaaaa@gmail.com") {
            //    alert(email);
            //}
            });
        }


        function Authenticate(email, password) {
            //alert(email + ', ' + password);
            firebase.auth().signInWithEmailAndPassword(email, password).then(function (value) {
            }).catch(function (error) {
                //alert(error);
            });

        }


        function Create(id, name, email, password, teleid) {
         firebase.database().ref('users/' + id).set({

          userid: id,
          teleid : teleid,
           username: email,
           email: email,
        password : email,
             name:name,
             displayName:name,
            photoURL: "http://chittagongit.com//images/icon-user/icon-user-2.jpg"

                        //profile_picture: imageUrl
                    });
        }
        function Update() {
            firebase.auth().onAuthStateChanged(function (user) {
                alert('update data');
                user.updateProfile({
                    name: "rambo",
                    displayName: "john wick",
                    photoURL: "http://chittagongit.com//images/icon-user/icon-user-2.jpg",
                    userid: user.uid,
                    teleid: 7,
                    username: "MyNameisKhan",
                    email: "husain@gmail.com",
                    firstName: "Ausnain",
                    lastName: "Ahmad",
                    Qualification: "BSCS(hons)",
                    Designation: "Senior Software Engineer"

                }).then(function () {
                    // Update successful.
                }).catch(function (error) {
                    // An error happened.
                });
            });
        }

        function Detail() {
            var name, email, photoUrl, uid, emailVerified, teleid;
            firebase.auth().onAuthStateChanged(function (user) {
                if (user != null) {
                    name = user.displayName;
                    email = user.email;
                    photoUrl = user.photoURL;
                    emailVerified = user.emailVerified;
                    uid = user.uid;
                    teleid = user.teleid;
                }
                alert(name + ', ' + email + ', ' + photoUrl + ', ' + uid + ', ' + emailVerified + ', teleid : ' + teleid);
            });
        }


        //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< END >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

        //<<<<<<<<<<<<<<<<<<< Delete Current User >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
        //var user = firebase.auth().currentUser;

        //user.delete().then(function () {
        //    // User deleted.
        //}).catch(function (error) {
        //    // An error happened.
        //});

        //<<<<<<<<<<<<<<<<<<<<<<<< END >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
        /**
         * Handles the sign in button press.
         */
        function toggleSignIn() {
            if (firebase.auth().currentUser) {
                // [START signout]
                firebase.auth().signOut();
                // [END signout]
            } else {
                // [START authanon]
                firebase.auth().signInAnonymously().catch(function (error) {
                    // Handle Errors here.
                    var errorCode = error.code;
                    var errorMessage = error.message;
                    // [START_EXCLUDE]
                    if (errorCode === 'auth/operation-not-allowed') {
                        alert('You must enable Anonymous auth in the Firebase Console.');
                    } else {
                        console.error(error);
                    }
                    // [END_EXCLUDE]
                });
                // [END authanon]
            }
            document.getElementById('quickstart-sign-in').disabled = true;
        }


        /**
         * initApp handles setting up UI event listeners and registering Firebase auth listeners:
         *  - firebase.auth().onAuthStateChanged: This listener is called when the user is signed in or
         *    out, and that is where we update the UI.
         */
        function initApp() {

            // Listening for auth state changes.
            // [START authstatelistener]
            firebase.auth().onAuthStateChanged(function (user) {
                if (user) {
                    // User is signed in.
                    var isAnonymous = user.isAnonymous;
                    var uid = user.uid;
                    // [START_EXCLUDE]
                    document.getElementById('quickstart-sign-in-status').textContent = 'Signed in';
                    document.getElementById('quickstart-sign-in').textContent = 'Sign out';
                    document.getElementById('quickstart-account-details').textContent = JSON.stringify(user, null, '  ');
                    // [END_EXCLUDE]
                } else {
                    // User is signed out.
                    // [START_EXCLUDE]
                    document.getElementById('quickstart-sign-in-status').textContent = 'Signed out';
                    document.getElementById('quickstart-sign-in').textContent = 'Sign in';
                    document.getElementById('quickstart-account-details').textContent = 'null';
                    // [END_EXCLUDE]
                }
                // [START_EXCLUDE]
                document.getElementById('quickstart-sign-in').disabled = false;
                // [END_EXCLUDE]
            });
            // [END authstatelistener]

            document.getElementById('quickstart-sign-in').addEventListener('click', toggleSignIn, false);
            // var userId = "KsKJymgSy1fD7qHO8cXnAzNBEEl2";
            var userId = "G0olETaxnIQj5ZuclV5VzjoXMEH2";
            var name = "Hawk Logix Husnain Ahmad";
            writeUserData(userId, name);

            //CallBothFunctions();
            //TestApp();
            SaveDataInFireBase();
        }

        function SaveDataInFireBase() {
            debugger;
            var myArr = [];

            @foreach (var item in Model)
            {

            @:myArr.push({ _id: "@item.user_id", _teleid: "@item.teleid", _email: "@item.email", _password: "@item.password", _name: "@item.name" });

                }


            PassValues(myArr);

        }

        function PassValues(myArr) {
            for (var i = 0; i < myArr.length; i++) {
                var id = myArr[i]._id;
                var teleid = myArr[i]._teleid;
                var email = myArr[i]._email;
                var password = myArr[i]._password;
                var name = myArr[i]._name;

                CallBothFunctions(id, name, email, password, teleid);
            }
        }

        window.onload = function () {
            initApp();
        };
    </script>


</head>
<body>
    <div class="demo-layout mdl-layout mdl-js-layout mdl-layout--fixed-header">
        <!-- Header section containing title -->
        <header class="mdl-layout__header mdl-color-text--white mdl-color--light-blue-700">
            <div class="mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-grid">
                <div class="mdl-layout__header-row mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-cell--8-col-desktop">
                    <a href="/"><h3>Firebase Authentication</h3></a>
                </div>
            </div>
        </header>
        <main class="mdl-layout__content mdl-color--grey-100">
            <div class="mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-grid">
                <!-- Container for the demo -->
                <div class="mdl-card mdl-shadow--2dp mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-cell--12-col-desktop">
                    <div class="mdl-card__title mdl-color--light-blue-600 mdl-color-text--white">
                        <h2 class="mdl-card__title-text">Anonymous Authentication</h2>
                    </div>
                    <div class="mdl-card__supporting-text mdl-color-text--grey-600">
                        <p>Sign in anonymously.</p>
                        <button disabled class="mdl-button mdl-js-button mdl-button--raised" id="quickstart-sign-in" name="signin">Sign in</button>
                        <!-- Container where we'll display the user details -->
                        <div class="quickstart-user-details-container">
                            Firebase sign-in status: <span id="quickstart-sign-in-status">Unknown</span>
                            <div>Firebase auth <code>currentUser</code> object value:</div>
                            <pre><code id="quickstart-account-details">null</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</body>
</html>
